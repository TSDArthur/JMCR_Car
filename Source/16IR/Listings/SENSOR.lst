C51 COMPILER V9.54   SENSOR                                                                03/18/2019 17:47:40 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE SENSOR
OBJECT MODULE PLACED IN .\Objects\SENSOR.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE HARDWARE\SENSOR.c LARGE OPTIMIZE(8,SPEED) BROWSE INCDIR(.\HARDWARE;.\LIB
                    -) DEBUG OBJECTEXTEND CODE NOCOND PRINT(.\Listings\SENSOR.lst) TABS(2) OBJECT(.\Objects\SENSOR.obj)

line level    source

   1          #include "STC15.h"
   2          #include "IO.h"
   3          #include "STDFUNC.h"
   4          #include "SENSOR.h"
   5          
   6          u8 sensorData[SENSOR_NUM] = {0};
   7          u8 sensorMap[SENSOR_MAP] = {7, 6, 5, 4, 3, 2, 1, 0};
   8          int leftValue = 0;
   9          int rightValue = 0;
  10          u8 isSensorInit = 0;
  11          
  12          //Init the Sensor
  13          void Sensor_Init()
  14          {
  15   1        if(isSensorInit)return;
  16   1        pinModeGroup(0, IO_MODE);
  17   1        pinMode(LD_GROUP, LD_ID, OUTPUT_PP);
  18   1        pinMode(CH_GROUP, CH_ID, OUTPUT_PP);
  19   1        //Init LED
  20   1        digitalWrite(OUTPUT_PP, LD_GROUP, LD_ID, 1);
  21   1        //Init Channel
  22   1        digitalWrite(OUTPUT_PP, CH_GROUP, CH_ID, 1);
  23   1        isSensorInit = 1;
  24   1      }
  25          
  26          //Refresh Sensor Data
  27          void Sensor_RefreshData()
  28          {
  29   1        int i;
  30   1        u8 roundNum;
  31   1        roundNum = SENSOR_NUM / 2;
  32   1        //Get Data 1 - 8
  33   1        digitalWrite(OUTPUT_PP, CH_GROUP, CH_ID, 1);
  34   1        delay_ms(WAIT_TIME);
  35   1        for(i = 0; i < roundNum; i++)
  36   1        {
  37   2          sensorData[i] = digitalRead(IO_MODE, 0, i) == SENSOR_SAMPLE;
  38   2        }
  39   1        //Get Data 9-16
  40   1        digitalWrite(OUTPUT_PP, CH_GROUP, CH_ID, 0);
  41   1        delay_ms(WAIT_TIME);
  42   1        for(i = roundNum; i < SENSOR_NUM; i++)
  43   1        {
  44   2          sensorData[i] = digitalRead(IO_MODE, 0, i) == SENSOR_SAMPLE;
  45   2        }
  46   1      }
  47          
  48          //Get Single Sensor Data
  49          u8 Sensor_GetSingleData(u8 sensorID)
  50          {
  51   1        Sensor_RefreshData();
  52   1        return digitalRead(IO_MODE, 0, sensorID) == SENSOR_SAMPLE;
  53   1      }
  54          
C51 COMPILER V9.54   SENSOR                                                                03/18/2019 17:47:40 PAGE 2   

  55          //Get Sensor Data for PID
  56          int Sensor_GetData()
  57          {
  58   1        u8 i;
  59   1        leftValue = 0;
  60   1        rightValue = 0;
  61   1        Sensor_RefreshData();
  62   1        for(i = L0; i >= L7 ; i--)leftValue = maxInt(leftValue, sensorData[i] * sensorMap[L0 - i]);
  63   1        for(i = R0; i <= R7; i++)rightValue = maxInt(rightValue, sensorData[i] * sensorMap[i - R0]);
  64   1        return rightValue - leftValue;
  65   1      }
  66          
C51 COMPILER V9.54   SENSOR                                                                03/18/2019 17:47:40 PAGE 3   

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION Sensor_Init (BEGIN)
                                           ; SOURCE LINE # 13
                                           ; SOURCE LINE # 14
                                           ; SOURCE LINE # 15
0000 900000      R     MOV     DPTR,#isSensorInit
0003 E0                MOVX    A,@DPTR
0004 703A              JNZ     ?C0002
0006         ?C0001:
                                           ; SOURCE LINE # 16
0006 E4                CLR     A
0007 FD                MOV     R5,A
0008 FF                MOV     R7,A
0009 120000      E     LCALL   _pinModeGroup
                                           ; SOURCE LINE # 17
000C 7B03              MOV     R3,#03H
000E E4                CLR     A
000F FD                MOV     R5,A
0010 7F01              MOV     R7,#01H
0012 120000      E     LCALL   _pinMode
                                           ; SOURCE LINE # 18
0015 7B03              MOV     R3,#03H
0017 7D01              MOV     R5,#01H
0019 7F01              MOV     R7,#01H
001B 120000      E     LCALL   _pinMode
                                           ; SOURCE LINE # 20
001E 900000      E     MOV     DPTR,#?_digitalWrite?BYTE+03H
0021 7401              MOV     A,#01H
0023 F0                MOVX    @DPTR,A
0024 E4                CLR     A
0025 FB                MOV     R3,A
0026 7D01              MOV     R5,#01H
0028 7F03              MOV     R7,#03H
002A 120000      E     LCALL   _digitalWrite
                                           ; SOURCE LINE # 22
002D 900000      E     MOV     DPTR,#?_digitalWrite?BYTE+03H
0030 7401              MOV     A,#01H
0032 F0                MOVX    @DPTR,A
0033 FB                MOV     R3,A
0034 FD                MOV     R5,A
0035 7F03              MOV     R7,#03H
0037 120000      E     LCALL   _digitalWrite
                                           ; SOURCE LINE # 23
003A 900000      R     MOV     DPTR,#isSensorInit
003D 7401              MOV     A,#01H
003F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 24
0040         ?C0002:
0040 22                RET     
             ; FUNCTION Sensor_Init (END)

             ; FUNCTION Sensor_RefreshData (BEGIN)
                                           ; SOURCE LINE # 27
                                           ; SOURCE LINE # 28
                                           ; SOURCE LINE # 31
0000 900000      R     MOV     DPTR,#roundNum
0003 7408              MOV     A,#08H
0005 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 33
0006 900000      E     MOV     DPTR,#?_digitalWrite?BYTE+03H
C51 COMPILER V9.54   SENSOR                                                                03/18/2019 17:47:40 PAGE 4   

0009 7401              MOV     A,#01H
000B F0                MOVX    @DPTR,A
000C FB                MOV     R3,A
000D FD                MOV     R5,A
000E 7F03              MOV     R7,#03H
0010 120000      E     LCALL   _digitalWrite
                                           ; SOURCE LINE # 34
0013 7F01              MOV     R7,#01H
0015 7E00              MOV     R6,#00H
0017 120000      E     LCALL   _delay_ms
                                           ; SOURCE LINE # 35
001A E4                CLR     A
001B 900000      R     MOV     DPTR,#i
001E F0                MOVX    @DPTR,A
001F A3                INC     DPTR
0020 F0                MOVX    @DPTR,A
0021         ?C0003:
0021 900000      R     MOV     DPTR,#roundNum
0024 E0                MOVX    A,@DPTR
0025 FF                MOV     R7,A
0026 900000      R     MOV     DPTR,#i
0029 E0                MOVX    A,@DPTR
002A FC                MOV     R4,A
002B A3                INC     DPTR
002C E0                MOVX    A,@DPTR
002D FD                MOV     R5,A
002E C3                CLR     C
002F 9F                SUBB    A,R7
0030 7480              MOV     A,#080H
0032 F8                MOV     R0,A
0033 EC                MOV     A,R4
0034 6480              XRL     A,#080H
0036 98                SUBB    A,R0
0037 5033              JNC     ?C0004
                                           ; SOURCE LINE # 36
                                           ; SOURCE LINE # 37
0039 AB05              MOV     R3,AR5
003B E4                CLR     A
003C FD                MOV     R5,A
003D FF                MOV     R7,A
003E 120000      E     LCALL   _digitalRead
0041 EF                MOV     A,R7
0042 7004              JNZ     ?C0006
0044 7F01              MOV     R7,#01H
0046 8002              SJMP    ?C0007
0048         ?C0006:
0048 7F00              MOV     R7,#00H
004A         ?C0007:
004A 900000      R     MOV     DPTR,#i
004D E0                MOVX    A,@DPTR
004E FC                MOV     R4,A
004F A3                INC     DPTR
0050 E0                MOVX    A,@DPTR
0051 2400        R     ADD     A,#LOW sensorData
0053 F582              MOV     DPL,A
0055 7400        R     MOV     A,#HIGH sensorData
0057 3C                ADDC    A,R4
0058 F583              MOV     DPH,A
005A EF                MOV     A,R7
005B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 38
005C 900000      R     MOV     DPTR,#i+01H
C51 COMPILER V9.54   SENSOR                                                                03/18/2019 17:47:40 PAGE 5   

005F E0                MOVX    A,@DPTR
0060 04                INC     A
0061 F0                MOVX    @DPTR,A
0062 70BD              JNZ     ?C0003
0064 900000      R     MOV     DPTR,#i
0067 E0                MOVX    A,@DPTR
0068 04                INC     A
0069 F0                MOVX    @DPTR,A
006A         ?C0024:
006A 80B5              SJMP    ?C0003
006C         ?C0004:
                                           ; SOURCE LINE # 40
006C E4                CLR     A
006D 900000      E     MOV     DPTR,#?_digitalWrite?BYTE+03H
0070 F0                MOVX    @DPTR,A
0071 7B01              MOV     R3,#01H
0073 7D01              MOV     R5,#01H
0075 7F03              MOV     R7,#03H
0077 120000      E     LCALL   _digitalWrite
                                           ; SOURCE LINE # 41
007A 7F01              MOV     R7,#01H
007C 7E00              MOV     R6,#00H
007E 120000      E     LCALL   _delay_ms
                                           ; SOURCE LINE # 42
0081 900000      R     MOV     DPTR,#roundNum
0084 E0                MOVX    A,@DPTR
0085 FF                MOV     R7,A
0086 900000      R     MOV     DPTR,#i
0089 E4                CLR     A
008A F0                MOVX    @DPTR,A
008B A3                INC     DPTR
008C EF                MOV     A,R7
008D F0                MOVX    @DPTR,A
008E         ?C0008:
008E 900000      R     MOV     DPTR,#i
0091 E0                MOVX    A,@DPTR
0092 FE                MOV     R6,A
0093 A3                INC     DPTR
0094 E0                MOVX    A,@DPTR
0095 FF                MOV     R7,A
0096 C3                CLR     C
0097 9410              SUBB    A,#010H
0099 EE                MOV     A,R6
009A 6480              XRL     A,#080H
009C 9480              SUBB    A,#080H
009E 5033              JNC     ?C0013
                                           ; SOURCE LINE # 43
                                           ; SOURCE LINE # 44
00A0 AB07              MOV     R3,AR7
00A2 E4                CLR     A
00A3 FD                MOV     R5,A
00A4 FF                MOV     R7,A
00A5 120000      E     LCALL   _digitalRead
00A8 EF                MOV     A,R7
00A9 7004              JNZ     ?C0011
00AB 7F01              MOV     R7,#01H
00AD 8002              SJMP    ?C0012
00AF         ?C0011:
00AF 7F00              MOV     R7,#00H
00B1         ?C0012:
00B1 900000      R     MOV     DPTR,#i
00B4 E0                MOVX    A,@DPTR
C51 COMPILER V9.54   SENSOR                                                                03/18/2019 17:47:40 PAGE 6   

00B5 FC                MOV     R4,A
00B6 A3                INC     DPTR
00B7 E0                MOVX    A,@DPTR
00B8 2400        R     ADD     A,#LOW sensorData
00BA F582              MOV     DPL,A
00BC 7400        R     MOV     A,#HIGH sensorData
00BE 3C                ADDC    A,R4
00BF F583              MOV     DPH,A
00C1 EF                MOV     A,R7
00C2 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 45
00C3 900000      R     MOV     DPTR,#i+01H
00C6 E0                MOVX    A,@DPTR
00C7 04                INC     A
00C8 F0                MOVX    @DPTR,A
00C9 70C3              JNZ     ?C0008
00CB 900000      R     MOV     DPTR,#i
00CE E0                MOVX    A,@DPTR
00CF 04                INC     A
00D0 F0                MOVX    @DPTR,A
00D1         ?C0025:
00D1 80BB              SJMP    ?C0008
                                           ; SOURCE LINE # 46
00D3         ?C0013:
00D3 22                RET     
             ; FUNCTION Sensor_RefreshData (END)

             ; FUNCTION _Sensor_GetSingleData (BEGIN)
                                           ; SOURCE LINE # 49
0000 900000      R     MOV     DPTR,#sensorID
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 50
                                           ; SOURCE LINE # 51
0005 120000      R     LCALL   Sensor_RefreshData
                                           ; SOURCE LINE # 52
0008 900000      R     MOV     DPTR,#sensorID
000B E0                MOVX    A,@DPTR
000C FB                MOV     R3,A
000D E4                CLR     A
000E FD                MOV     R5,A
000F FF                MOV     R7,A
0010 120000      E     LCALL   _digitalRead
0013 EF                MOV     A,R7
0014 7004              JNZ     ?C0014
0016 7F01              MOV     R7,#01H
0018 8002              SJMP    ?C0015
001A         ?C0014:
001A 7F00              MOV     R7,#00H
001C         ?C0015:
                                           ; SOURCE LINE # 53
001C         ?C0016:
001C 22                RET     
             ; FUNCTION _Sensor_GetSingleData (END)

             ; FUNCTION Sensor_GetData (BEGIN)
                                           ; SOURCE LINE # 56
                                           ; SOURCE LINE # 57
                                           ; SOURCE LINE # 59
0000 E4                CLR     A
0001 900000      R     MOV     DPTR,#leftValue
0004 F0                MOVX    @DPTR,A
C51 COMPILER V9.54   SENSOR                                                                03/18/2019 17:47:40 PAGE 7   

0005 A3                INC     DPTR
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 60
0007 900000      R     MOV     DPTR,#rightValue
000A F0                MOVX    @DPTR,A
000B A3                INC     DPTR
000C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 61
000D 120000      R     LCALL   Sensor_RefreshData
                                           ; SOURCE LINE # 62
0010 900000      R     MOV     DPTR,#i
0013 740F              MOV     A,#0FH
0015 F0                MOVX    @DPTR,A
0016         ?C0017:
0016 900000      R     MOV     DPTR,#i
0019 E0                MOVX    A,@DPTR
001A FF                MOV     R7,A
001B FD                MOV     R5,A
001C C3                CLR     C
001D 740F              MOV     A,#0FH
001F 9D                SUBB    A,R5
0020 FD                MOV     R5,A
0021 E4                CLR     A
0022 9400              SUBB    A,#00H
0024 FC                MOV     R4,A
0025 7400        R     MOV     A,#LOW sensorMap
0027 2D                ADD     A,R5
0028 F582              MOV     DPL,A
002A 7400        R     MOV     A,#HIGH sensorMap
002C 3C                ADDC    A,R4
002D F583              MOV     DPH,A
002F E0                MOVX    A,@DPTR
0030 FE                MOV     R6,A
0031 7400        R     MOV     A,#LOW sensorData
0033 2F                ADD     A,R7
0034 F582              MOV     DPL,A
0036 E4                CLR     A
0037 3400        R     ADDC    A,#HIGH sensorData
0039 F583              MOV     DPH,A
003B E0                MOVX    A,@DPTR
003C 8EF0              MOV     B,R6
003E A4                MUL     AB
003F FD                MOV     R5,A
0040 ACF0              MOV     R4,B
0042 900000      R     MOV     DPTR,#leftValue
0045 E0                MOVX    A,@DPTR
0046 FE                MOV     R6,A
0047 A3                INC     DPTR
0048 E0                MOVX    A,@DPTR
0049 FF                MOV     R7,A
004A 120000      E     LCALL   _maxInt
004D 900000      R     MOV     DPTR,#leftValue
0050 EE                MOV     A,R6
0051 F0                MOVX    @DPTR,A
0052 A3                INC     DPTR
0053 EF                MOV     A,R7
0054 F0                MOVX    @DPTR,A
0055 900000      R     MOV     DPTR,#i
0058 E0                MOVX    A,@DPTR
0059 14                DEC     A
005A F0                MOVX    @DPTR,A
005B E0                MOVX    A,@DPTR
C51 COMPILER V9.54   SENSOR                                                                03/18/2019 17:47:40 PAGE 8   

005C C3                CLR     C
005D 9408              SUBB    A,#08H
005F 50B5              JNC     ?C0017
0061         ?C0018:
                                           ; SOURCE LINE # 63
0061 E4                CLR     A
0062 900000      R     MOV     DPTR,#i
0065 F0                MOVX    @DPTR,A
0066         ?C0020:
0066 900000      R     MOV     DPTR,#i
0069 E0                MOVX    A,@DPTR
006A FF                MOV     R7,A
006B 2400        R     ADD     A,#LOW sensorMap
006D F582              MOV     DPL,A
006F E4                CLR     A
0070 3400        R     ADDC    A,#HIGH sensorMap
0072 F583              MOV     DPH,A
0074 E0                MOVX    A,@DPTR
0075 FE                MOV     R6,A
0076 7400        R     MOV     A,#LOW sensorData
0078 2F                ADD     A,R7
0079 F582              MOV     DPL,A
007B E4                CLR     A
007C 3400        R     ADDC    A,#HIGH sensorData
007E F583              MOV     DPH,A
0080 E0                MOVX    A,@DPTR
0081 8EF0              MOV     B,R6
0083 A4                MUL     AB
0084 FD                MOV     R5,A
0085 ACF0              MOV     R4,B
0087 900000      R     MOV     DPTR,#rightValue
008A E0                MOVX    A,@DPTR
008B FE                MOV     R6,A
008C A3                INC     DPTR
008D E0                MOVX    A,@DPTR
008E FF                MOV     R7,A
008F 120000      E     LCALL   _maxInt
0092 900000      R     MOV     DPTR,#rightValue
0095 EE                MOV     A,R6
0096 F0                MOVX    @DPTR,A
0097 A3                INC     DPTR
0098 EF                MOV     A,R7
0099 F0                MOVX    @DPTR,A
009A 900000      R     MOV     DPTR,#i
009D E0                MOVX    A,@DPTR
009E 04                INC     A
009F F0                MOVX    @DPTR,A
00A0 E0                MOVX    A,@DPTR
00A1 D3                SETB    C
00A2 9407              SUBB    A,#07H
00A4 40C0              JC      ?C0020
00A6         ?C0021:
                                           ; SOURCE LINE # 64
00A6 900000      R     MOV     DPTR,#leftValue
00A9 E0                MOVX    A,@DPTR
00AA FE                MOV     R6,A
00AB A3                INC     DPTR
00AC E0                MOVX    A,@DPTR
00AD FF                MOV     R7,A
00AE C3                CLR     C
00AF 900000      R     MOV     DPTR,#rightValue+01H
00B2 E0                MOVX    A,@DPTR
C51 COMPILER V9.54   SENSOR                                                                03/18/2019 17:47:40 PAGE 9   

00B3 9F                SUBB    A,R7
00B4 FF                MOV     R7,A
00B5 900000      R     MOV     DPTR,#rightValue
00B8 E0                MOVX    A,@DPTR
00B9 9E                SUBB    A,R6
00BA FE                MOV     R6,A
                                           ; SOURCE LINE # 65
00BB         ?C0023:
00BB 22                RET     
             ; FUNCTION Sensor_GetData (END)



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    494    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     29       5
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
